<?xml version="1.0"?>
  <database name="VIEW ATECDP_FINACC_TRANSACTION_V">
    <view name="ATECDP_FINACC_TRANSACTION_V"><![CDATA[SELECT CASE WHEN fpv.isreceipt = 'Y' THEN replace(regexp_replace(fpv.deposito || to_char(sum(fpv.depositamt)), '[^\w\s]', '', 'g'), ' ', '') ELSE replace(regexp_replace(fpv.deposito || to_char(sum(fpv.paymentamt)), '[^\w\s]', '', 'g'), ' ', '') END AS atecdp_finacc_transaction_v_id, fpv.ad_client_id, fpv.ad_org_id, fpv.created, fpv.createdby, fpv.updated, fpv.updatedby, fpv.isactive, fpv.deposito, fpv.statementdate, sum(fpv.depositamt) AS valor_depositado, sum(fpv.paymentamt) AS valor_pagado, fpv.isreceipt, string_agg(fpv.description, '') AS description, fpv.fin_financial_account_id, fpv.status, fpv.processed, fpv.fin_reconciliation_id, fpv.em_aprm_reconcile_payment AS ispaymentreconcile FROM (SELECT ft1.statementdate + 0 AS statementdate, ft1.fin_financial_account_id, CASE WHEN fp.em_atecdp_deposito IS NULL OR fp.em_atecdp_deposito = '' THEN fp.documentno ELSE fp.em_atecdp_deposito END AS deposito, ft1.description, fp.isreceipt, fp.status, fp.em_aprm_reconcile_payment, fp.ad_client_id, fp.ad_org_id, fp.isactive, ft1.fin_reconciliation_id, ft1.processed, (SELECT fin_payment.created FROM fin_payment LIMIT 1) AS created, to_char('0') AS createdby, (SELECT fin_payment.updated FROM fin_payment LIMIT 1) AS updated, to_char('0') AS updatedby, (SELECT COALESCE(sum(p.amount), 0) AS "coalesce" FROM fin_payment p WHERE p.fin_payment_id = fp.fin_payment_id AND p.isreceipt = 'Y') AS depositamt, (SELECT COALESCE(sum(p.amount), 0) AS "coalesce" FROM fin_payment p WHERE p.fin_payment_id = fp.fin_payment_id AND p.isreceipt = 'N') AS paymentamt FROM fin_payment fp, fin_finacc_transaction ft1 WHERE fp.fin_payment_id = ft1.fin_payment_id AND fp.em_aprm_reconcile_payment = 'N') fpv GROUP BY fpv.statementdate, fpv.ad_client_id, fpv.ad_org_id, fpv.created, fpv.createdby, fpv.updated, fpv.updatedby, fpv.isactive, fpv.isreceipt, fpv.deposito, fpv.fin_financial_account_id, fpv.status, fpv.em_aprm_reconcile_payment, fpv.fin_reconciliation_id, fpv.processed UNION SELECT fin_finacc_transaction.fin_finacc_transaction_id AS atecdp_finacc_transaction_v_id, fin_finacc_transaction.ad_client_id, fin_finacc_transaction.ad_org_id, fin_finacc_transaction.created, fin_finacc_transaction.createdby, fin_finacc_transaction.updated, fin_finacc_transaction.updatedby, fin_finacc_transaction.isactive, NULL AS deposito, fin_finacc_transaction.statementdate + 0 AS statementdate, fin_finacc_transaction.depositamt AS valor_depositado, fin_finacc_transaction.paymentamt AS valor_pagado, CASE WHEN fin_finacc_transaction.depositamt > 0 THEN 'Y' ELSE 'N' END AS isreceipt, fin_finacc_transaction.description, fin_finacc_transaction.fin_financial_account_id, fin_finacc_transaction.status, fin_finacc_transaction.processed, fin_finacc_transaction.fin_reconciliation_id, 'N' AS ispaymentreconcile FROM fin_finacc_transaction WHERE fin_finacc_transaction.fin_payment_id IS NULL]]></view>
  </database>
