<?xml version="1.0"?>
  <database name="FUNCTION ASV_GUIA_INGRESO_LDM">
    <function name="ASV_GUIA_INGRESO_LDM" type="NULL">
      <parameter name="v_m_production_id" type="VARCHAR" mode="in">
        <default/>
      </parameter>
      <body><![CDATA[v_ad_client_id character varying(32);
	v_ad_org_id character varying(32);
	v_createdby character varying(32);
	v_updatedby character varying(32);
	v_c_bpartner_id character varying(32);
	v_c_bpartner_location_id character varying(32);
	v_m_warehouse_id character varying(32):='';
	v_documentno character varying(30);
	v_m_inout_id character varying(32);
	
	v_cursor RECORD;
	v_pcursor RECORD;
	v_line NUMBER(10,0) := 0;
	v_c_uom_id character varying(32);
	v_m_locator_id character varying(32);
	v_bnd character(1) := 'Y';
	v_movementqty NUMBER;

BEGIN
	select ad_client_id, ad_org_id, createdby, 
		updatedby
	into v_ad_client_id, v_ad_org_id, v_createdby,
		v_updatedby
	from m_production where m_production_id = v_m_production_id;
	
	
	select c_bpartner_id 
	into v_c_bpartner_id 
	from c_bpartner 
	where name = 'ASERLACO S.A.';

	select c_bpartner_location_id
	into v_c_bpartner_location_id
	from c_bpartner_location
	where c_bpartner_id = v_c_bpartner_id;

	FOR v_cursor IN (
		select *
		from m_production p, m_productionplan pp, m_productionline pl
		where p.m_production_id = pp.m_production_id
		and pp.m_productionplan_id = pl.m_productionplan_id
		and p.m_production_id = v_m_production_id
		)
	LOOP
		if v_cursor.movementqty > 0 then
			if v_bnd = 'Y' then
				v_m_inout_id := get_uuid();

				select m_locator_id, m_warehouse_id
				into v_m_locator_id, v_m_warehouse_id
				from m_locator
				where ad_org_id = v_cursor.AD_Org_ID
				and value = 'TransformaciÃ³n';

				Ad_Sequence_Doctype('2030AD7DD4284E2B936E261662EF735A', v_ad_client_id, 'Y', v_documentno);
				INSERT INTO m_inout(
					m_inout_id, 
					ad_client_id, 
					ad_org_id, 
					createdby, 
					updatedby, 
					documentno, 
					docaction, 
					docstatus, 
					c_doctype_id, 
					movementdate, 
					dateacct, 
					c_bpartner_id, 
					c_bpartner_location_id, 
					m_warehouse_id, 
					deliveryrule, 
					freightcostrule, 
					deliveryviarule, 
					priorityrule, 
					issotrx, 
					processing
					)
				VALUES (
					v_m_inout_id, 
					v_ad_client_id, 
					v_ad_org_id, 
					v_createdby, 
					v_updatedby, 
					v_documentno, 
					'CO', 
					'DR', 
					'2030AD7DD4284E2B936E261662EF735A', 
					now(), 
					now(),
					v_c_bpartner_id, 
					v_c_bpartner_location_id, 
					v_m_warehouse_id, 
					'A', 
					'I', 
					'P', 
					'5',
					'N',
					'N'
					);
				v_bnd = 'N';
			end if;
			SELECT c_uom_id INTO v_c_uom_id FROM m_product where m_product_id = v_cursor.m_product_id;--Unidad del producto
			v_line := v_line + 10;
			INSERT INTO m_inoutline(
				m_inoutline_id, 
				ad_client_id, 
				ad_org_id, 
				createdby, 
				updatedby, 
				line, 
				m_inout_id, 
				m_product_id, 
				c_uom_id, 
				movementqty, 
				c_bpartner_id,
				m_locator_id
				)
			VALUES (
				get_uuid(), 
				v_ad_client_id, 
				v_ad_org_id, 
				v_createdby, 
				v_updatedby, 
				v_line, 
				v_m_inout_id, 
				v_cursor.m_product_id, 
				v_c_uom_id, 
				v_cursor.movementqty, 
				v_c_bpartner_id,
				v_m_locator_id
				);
		
		end if;
	END LOOP;

	M_INOUT_POST(null, v_m_inout_id);
    
RETURN;
END ASV_GUIA_INGRESO_LDM
]]></body>
    </function>
  </database>
